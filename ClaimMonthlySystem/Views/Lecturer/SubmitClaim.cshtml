@model Claim
@{
    ViewData["Title"] = "Submit Claim";
}

<h2>Submit New Claim</h2>

<div class="row">
    <div class="col-md-8">
        <form asp-action="SubmitClaim" method="post" enctype="multipart/form-data" id="claimForm">
            <div class="form-group mb-3">
                <label asp-for="HoursWorked" class="form-label">Hours Worked *</label>
                <input asp-for="HoursWorked" class="form-control" type="number" step="0.5" min="0.5" required>
                <span asp-validation-for="HoursWorked" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="HourlyRate" class="form-label">Hourly Rate (Rands) *</label>
                <input asp-for="HourlyRate" class="form-control" type="number" step="0.01" min="0" required>
                <span asp-validation-for="HourlyRate" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="AdditionalNotes" class="form-label">Additional Notes</label>
                <textarea asp-for="AdditionalNotes" class="form-control" rows="4" placeholder="Please provide any additional information about your claim..."></textarea>
                <span asp-validation-for="AdditionalNotes" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label for="supportingDocument" class="form-label">Supporting Document (Optional)</label>
                <input type="file" class="form-control" id="supportingDocument" name="supportingDocument"
                       accept=".pdf,.docx,.xlsx">
                <small class="form-text text-muted">
                    Allowed file types: PDF, DOCX, XLSX. Maximum file size: 5MB.
                </small>
                <div id="fileError" class="text-danger small"></div>
            </div>

            <div class="form-group mb-3">
                <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                    <span id="submitText">Submit Claim</span>
                    <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none" role="status"></span>
                </button>
                <a href="@Url.Action("Index")" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>

    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h5>Claim Guidelines</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li>Enter total hours worked in the period</li>
                    <li>Use your standard hourly rate in Rands</li>
                    <li>Provide clear notes for verification</li>
                    <li>Upload supporting documents if available</li>
                    <li>Claims will be processed within 5 working days</li>
                </ul>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5>Quick Calculation</h5>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <label class="form-label">Hours:</label>
                    <input type="number" class="form-control" id="calcHours" step="0.5" min="0.5" placeholder="Enter hours">
                </div>
                <div class="mb-2">
                    <label class="form-label">Rate (R):</label>
                    <input type="number" class="form-control" id="calcRate" step="0.01" min="0" placeholder="Enter rate">
                </div>
                <div class="mb-2">
                    <label class="form-label">Total (R):</label>
                    <input type="text" class="form-control" id="calcTotal" readonly>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="calculateTotal()">Calculate</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // File validation
        document.getElementById('supportingDocument').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const errorDiv = document.getElementById('fileError');

            if (file) {
                const allowedExtensions = ['.pdf', '.docx', '.xlsx'];
                const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
                const maxSize = 5 * 1024 * 1024; // 5MB

                if (!allowedExtensions.includes(fileExtension)) {
                    errorDiv.textContent = 'Only PDF, DOCX, and XLSX files are allowed.';
                    e.target.value = '';
                } else if (file.size > maxSize) {
                    errorDiv.textContent = 'File size must be less than 5MB.';
                    e.target.value = '';
                } else {
                    errorDiv.textContent = '';
                }
            }
        });

        // Form submission handling
        document.getElementById('claimForm').addEventListener('submit', function() {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingSpinner = document.getElementById('loadingSpinner');

            submitBtn.disabled = true;
            submitText.textContent = 'Submitting...';
            loadingSpinner.classList.remove('d-none');
        });

        // Quick calculation
        function calculateTotal() {
            const hours = parseFloat(document.getElementById('calcHours').value) || 0;
            const rate = parseFloat(document.getElementById('calcRate').value) || 0;
            const total = hours * rate;

            document.getElementById('calcTotal').value = total.toFixed(2);

            // Auto-fill the form if user wants
            if (hours > 0 && rate > 0) {
                if (confirm('Would you like to use these values in your claim form?')) {
                    document.getElementById('HoursWorked').value = hours;
                    document.getElementById('HourlyRate').value = rate;
                }
            }
        }

        // Auto-calculate when both fields are filled
        document.getElementById('calcHours').addEventListener('input', calculateTotal);
        document.getElementById('calcRate').addEventListener('input', calculateTotal);
    </script>
}

@*                                     References
Maniya, A., 2025. Generate HTML File using C#. [Online]
Available at: https://www.c-sharpcorner.com/blogs/generate-html-file-from-code-behind-using-c-sharp
W3schools, 2024. ASP.NET Web Pages - Tutorial. [Online]
Available at: https://www.w3schools.com/asp/webpages_intro.asp
W3schools, 2025. HTML Forms. [Online]
Available at: https://www.w3schools.com/asp/webpages_forms.asp *@

